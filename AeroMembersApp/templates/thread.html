{% extends "base.html" %}
{% block content %}
<body ng-controller="forumCtrl">


    {%include 'header.html'%}


    <h2>{{ thread }}</h2>
    <h3 id="threadScore" class="{{threadScoreClass}}">{{ thread.score }}</h3>
    <h3>{{ thread.content }}</h3>
    <a href="javascript:void(0);" ng-click="upvoteThread({{thread.pk}})">Upvote Thread</a>
      <form method="post" action="/thread/{{thread.pk}}/">
        {% csrf_token %}
        {%for field in threadReplyForm%}
            <p>
            {{ field.label_tag }}<br>
            {{ field }}
            {% if field.help_text %}
              <small style="color: grey">{{ field.help_text }}</small>
            {% endif %}
            {% for error in field.errors %}
              <p style="color: red">{{ error }}</p>
            {% endfor %}
            </p>
        {%endfor%}
        <button type="submit">Reply</button>
    </form>

    {%for replyDict in flattenedReplies %}
        <div class="post_{{replyDict.reply.pk}}">
            <div>
                {{replyDict.reply.content}}
                {{replyDict.reply.pk}}
                {{replyDict.reply.createdBy}}
                <p id="postScore_{{replyDict.reply.pk}}" class="{{replyDict.scoreClass}}" >{{replyDict.reply.score}}</p>
                {% if user.is_authenticated %}
                    <a href="javascript:void(0);" ng-click="showReplyForm[{{replyDict.reply.pk}}] = true">Reply</a>
                    <a href="javascript:void(0);" ng-click="upvote({{replyDict.reply.pk}})">Upvote</a>
                    <a href="javascript:void(0);" ng-click="">Report*</a>
                    <a href="javascript:void(0);" ng-click="">Edit*</a>
                {% endif %}
            </div>
            <form method='post' action='/postreply/' ng-if='showReplyForm[{{replyDict.reply.pk}}] == true'>
                {% csrf_token %}
                <input type='text' name='replyContent'></input>
                <input type='hidden' name='postId' value='{{replyDict.reply.pk}}'></input>
                <input type='hidden' name='threadId' value='{{thread.pk}}'></input>
                <button ng-click='showReplyForm[{{replyDict.reply.pk}}] = false'>Cancel</button>
                <button type='submit'>Reply</button>
            </form>
            <div class="child">
                {% if tuple.1 == 0 %}
                <div class="table_{{reply.pk}}">
                {% endif %}
                {{replyDict.closingTags |safe}}
    {%endfor%}
</body>
<style>
.child{
    margin-left: 15px
}
</style>
{% endblock %}